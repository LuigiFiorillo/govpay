<link rel="import" href="../../../../bower_components/polymer/polymer.html">


<dom-module id="pagamento-detail">
    <template>
        <style include="shared-styles"></style>
        <style>
            :host {
            display: block;
            }
        </style>

        <div class="layout horizontal center-justified">
            <div class="layout vertical flex">
                <paper-tabs selected="{{selectedTab}}" noink >
                    <paper-tab>INFORMAZIONI GENERALI</paper-tab>
                    <paper-tab>SINGOLI IMPORTI</paper-tab>
                    <paper-tab>EVENTI</paper-tab>
                    <paper-tab>NOTIFICHE</paper-tab>
                </paper-tabs>

                <iron-pages selected="{{selectedTab}}">
                    <div class="layout horizontal center-justified">
                        <div id="pag-itembox" class="layout vertical flex itembox restorePadding">
                            <div class="layout horizontal flex">
                                <div class="layout horizontal center start-justified headerbox" >

                                </div>
                            </div>

                            <paper-material elevation="0">
                                <!--  <p class="groupTitle"><span class="groupTitle">INFORMAZIONI INTERMEDIARIO</span></p>-->

                                <p class="groupItem"><span class="grouplabel">Stato: </span><span>[[_getStatoPagamento(pagamentoCorrente)]]</span></p>
                                <p class="groupItem"><span class="grouplabel">Stato Rendicontazione: </span><span>[[_getStatoRendicontazionePagamento(pagamentoCorrente)]]</span></p>
                                <p class="groupItem"><span class="grouplabel">Dominio: </span><span>[[_getPropertyVersamento(pagamentoCorrente,'codDominio')]]</span></p>
                                <p class="groupItem"><span class="grouplabel">Applicazione: </span><span>[[_getPropertyApplicazione(pagamentoCorrente,'codApplicazione')]]</span></p>

                                <p class="groupItem"><span class="grouplabel">IUV: </span><span>[[_getPropertyVersamento(pagamentoCorrente,'iuv')]]</span></p>

                                <p class="groupItem"><span class="grouplabel">CCP: </span><span>[[_getCCP(pagamentoCorrente)]]</span></p>

                                <p class="groupItem"><span class="grouplabel">Beneficiario: </span><span>[[_visualizzaDettaglioBeneficiario(pagamentoCorrente)]]</span></p>
                                <p class="groupItem"><span class="grouplabel">Debitore: </span><span>[[_getDebitore(pagamentoCorrente)]]</span></p>
                                <p class="groupItem"><span class="grouplabel">Importo: </span><span>[[_getPropertyVersamento(pagamentoCorrente,'importoTotale')]]</span> &euro;</p>
                            </paper-material>

                            <!-- RPT -->
                            <paper-material elevation="0">
                                <p class="groupTitle"><span class="groupTitle">RPT</span></p>

                                <p class="groupItem"><span class="grouplabel">Stato: </span><span>[[_getPropertyRpt(pagamentoCorrente,'statoRpt')]]</span></p>
                                <p class="groupItem"><span class="grouplabel">IUV: </span><span>[[_getPropertyVersamento(pagamentoCorrente,'iuv')]]</span></p>
                                <p class="groupItem"><span class="grouplabel">CCP: </span><span>[[_getCCP(pagamentoCorrente)]]</span></p>
                                <p class="groupItem"><span class="grouplabel">Codice Carrello: </span><span>[[_getPropertyRpt(pagamentoCorrente,'codCarrello')]]</span></p>
                                <p class="groupItem"><span class="grouplabel">Codice Sessione: </span><span>[[_getPropertyRpt(pagamentoCorrente,'codSessione')]]</span></p>
                                <p class="groupItem"><span class="grouplabel">Dominio: </span><span>[[_getPropertyVersamento(pagamentoCorrente,'codDominio')]]</span></p>
                                <p class="groupItem"><span class="grouplabel">Psp: </span><span>[[_getPropertyPsp(pagamentoCorrente,'codPsp')]]</span></p>
                                <p class="groupItem"><span class="grouplabel">Canale: </span><span>[[pagamentoCorrente.canale.codCanale]]</span></p>
                                <p class="groupItem"><span class="grouplabel">Applicazione: </span><span>[[_getPropertyApplicazione(pagamentoCorrente,'codApplicazione')]]</span></p>
                                <p class="groupItem"><span class="grouplabel">Tipo Versamento: </span><span>[[_getPropertyRpt(pagamentoCorrente,'tipoVersamento')]]</span></p>
                                <template is="dom-if" if="[[_getVersante(pagamentoCorrente) != '']]">
                                    <p class="groupItem"><span class="grouplabel">Versante: </span><span>[[_getVersante(pagamentoCorrente)]]</span></p>
                                </template>
                                <p class="groupItem"><span class="grouplabel">Data Creazione: </span><span>[[_getDataFieldAsString(pagamentoCorrente.rpt,'dataOraCreazione')]]</span></p>
                                <p class="groupItem"><span class="grouplabel">Data Messaggio Richiesta: </span><span>[[_getDataFieldAsString(pagamentoCorrente.rpt,'dataOraMsgRichiesta')]]</span></p>
                                <p class="groupItem"><span class="grouplabel">Codice Messaggio Richiesta: </span><span>[[_getPropertyRpt(pagamentoCorrente,'codMsgRichiesta')]]</span></p>
                                <p class="groupItem"><span class="grouplabel">IBAN Addebito: </span><span>[[_getPropertyRpt(pagamentoCorrente,'ibanAddebito')]]</span></p>
                                <p class="groupItem"><span class="grouplabel">Firma Richiesta: </span><span>[[_getPropertyRpt(pagamentoCorrente,'firmaRichiesta')]]</span></p>
                                <p class="groupItem"><span class="grouplabel">Autenticazione Soggetto: </span><span>[[_getPropertyRpt(pagamentoCorrente,'autenticazioneSoggetto')]]</span></p>
                                <p class="groupItem"><span class="grouplabel">Fault Code: </span><span>[[_getPropertyRpt(pagamentoCorrente,'faultCode')]]</span></p>
                                <p class="groupItem"><span class="grouplabel">Descrizione Stato: </span><span>[[_getPropertyRpt(pagamentoCorrente,'descrizioneStato')]]</span></p>
                                <p class="groupItem"><span class="grouplabel">Callback URL: </span><span>[[_getPropertyRpt(pagamentoCorrente,'callbackURL')]]</span></p>
                                <p class="groupItem"><span class="grouplabel">PSP Redirect URL: </span><span>[[_getPropertyRpt(pagamentoCorrente,'pspRedirectURL')]]</span></p>

                                <paper-button class="green" raised on-tap="downloadRpt" hidden>
                                    <iron-icon icon="file-download"></iron-icon>
                                    Download
                                </paper-button>

                            </paper-material>

                            <!-- RT -->
                            <paper-material elevation="0">
                                <p class="groupTitle"><span class="groupTitle">RT</span></p>

                                <p class="groupItem"><span class="grouplabel">Id Messaggio: </span><span>[[_getPropertyRt(pagamentoCorrente,'codMsgRicevuta')]]</span></p>
                                <p class="groupItem"><span class="grouplabel">Data Creazione: </span><span>[[_getDataFieldAsString(pagamentoCorrente.rt,'dataOraMsgRicevuta')]]</span></p>
                                <p class="groupItem"><span class="grouplabel">Attestante: </span><span>[[_getDettaglioAnagrafica(pagamentoCorrente.rt.anagraficaAttestante)]]</span></p>
                                <p class="groupItem"><span class="grouplabel">Esito: </span><span>[[_getPropertyRt(pagamentoCorrente,'esitoPagamento')]]</span></p>
                                <p class="groupItem"><span class="grouplabel">Totale Pagato: </span><span>[[_getPropertyRt(pagamentoCorrente,'importoTotalePagato')]]</span></p>
                                <p class="groupItem"><span class="grouplabel">Stato: </span><span>[[_getPropertyRt(pagamentoCorrente,'stato')]]</span></p>
                                <p class="groupItem"><span class="grouplabel">Descrizione Stato: </span><span>[[_getPropertyRt(pagamentoCorrente,'descrizioneStato')]]</span></p>

                                <paper-button class="green" raised on-tap="downloadRt" hidden>
                                    <iron-icon icon="file-download"></iron-icon>
                                    Download
                                </paper-button>
                            </paper-material>
                        </div>
                    </div>

                    <!-- Singoli Versamenti -->
                    <div class="layout horizontal center-justified">
                        <div id="vers-resultbox" class="layout vertical flex restorePadding" >
                            <div class="layout horizontal flex">
                                <div class="layout horizontal center start-justified headerbox" >
                                    <p>Sono presenti [[pagamentoCorrente.versamento.singoliVersamenti.length]] Versamenti</p>
                                </div>
                                <div id="vers-listToolbox" class="layout horizontal center end-justified headerbox">
                                    <paper-icon-button icon="icons:file-upload" hidden$="{{nascondiAzioneExport}}"></paper-icon-button>
                                    <paper-icon-button icon="icons:remove" hidden$="{{nascondiAzioneCancella}}"></paper-icon-button>
                                </div>
                            </div>

                            <paper-material elevation="0">
                                <paper-input bind-value="{{filtro}}" on-bind-value-changed="_refreshList"
                                             class="flex filtro" label="Filtro">
                                </paper-input>
                                <paper-icon-item hidden$="{{!abilitaSelezione}}">
                                    <paper-checkbox item-icon></paper-checkbox>
                                    <div class="flex selectAll">Seleziona tutto</div>
                                </paper-icon-item>

                                <template is="dom-repeat" items="[[pagamentoCorrente.versamento.singoliVersamenti]]" filter="_filtraListaRisultati">
                                    <paper-icon-item class$="[[isEven(index)]]">
                                        <paper-checkbox item-icon hidden$="{{!abilitaSelezione}}"></paper-checkbox>
                                        <paper-item-body two-line>
                                            <div>IUSV: [[item.codSingoloVersamentoEnte]], Importo: [[item.importoSingoloVersamento]] &euro;, Stato: [[item.statoSingoloVersamento]]
                                            </div>
                                            <div secondary>Causale: [[item.causaleVersamento]]</div>
                                        </paper-item-body>
                                    </paper-icon-item>
                                </template>
                            </paper-material>
                        </div>
                    </div>

                    <!-- Eventi -->
                    <div class="layout horizontal center-justified">
                        <div id="evt-resultbox" class="layout vertical flex restorePadding" >
                            <div class="layout horizontal flex">
                                <div class="layout horizontal center start-justified headerbox" >
                                    <p>Sono stati registrati [[pagamentoCorrente.eventi.length]] Eventi</p>
                                </div>
                                <div id="evt-listToolbox" class="layout horizontal center end-justified headerbox">
                                    <paper-icon-button icon="icons:file-upload" hidden$="{{nascondiAzioneExport}}"></paper-icon-button>
                                    <paper-icon-button icon="icons:remove" hidden$="{{nascondiAzioneCancella}}"></paper-icon-button>
                                </div>
                            </div>

                            <paper-material elevation="0">
                                <paper-input bind-value="{{filtro}}" on-bind-value-changed="_refreshList"
                                             class="flex filtro" label="Filtro">
                                </paper-input>
                                <paper-icon-item hidden$="{{!abilitaSelezione}}">
                                    <paper-checkbox item-icon></paper-checkbox>
                                    <div class="flex selectAll">Seleziona tutto</div>
                                </paper-icon-item>

                                <template is="dom-repeat" items="[[pagamentoCorrente.eventi]]" filter="_filtraListaRisultati">
                                    <paper-icon-item class$="[[isEven(index)]]">
                                        <paper-checkbox item-icon hidden$="{{!abilitaSelezione}}"></paper-checkbox>
                                        <paper-item-body two-line>
                                            <div>[[_getDataFieldAsString(item,'dataOraEvento')]]: [[item.tipoEvento]] ( [[_getSottotipo(item)]] ) [[item.esito]]</div>
                                            <div secondary>Dominio: [[item.codDominio]], IUV: [[item.iuv]]</div>
                                        </paper-item-body>
                                    </paper-icon-item>
                                </template>
                            </paper-material>
                        </div>
                    </div>

                    <!-- Notifiche -->
                    <div class="layout horizontal center-justified">
                        <div id="notif-resultbox" class="layout vertical flex restorePadding" >
                            <div class="layout horizontal flex">
                                <div class="layout horizontal center start-justified headerbox" >
                                    <p>Sono presenti [[pagamentoCorrente.esiti.length]] Notifiche</p>
                                </div>
                                <div id="notif-listToolbox" class="layout horizontal center end-justified headerbox">
                                    <paper-icon-button icon="icons:file-upload" hidden$="{{nascondiAzioneExport}}"></paper-icon-button>
                                    <paper-icon-button icon="icons:remove" hidden$="{{nascondiAzioneCancella}}"></paper-icon-button>
                                </div>
                            </div>

                            <paper-material elevation="0">
                                <paper-input bind-value="{{filtro}}" on-bind-value-changed="_refreshList"
                                             class="flex filtro" label="Filtro">
                                </paper-input>
                                <paper-icon-item hidden$="{{!abilitaSelezione}}">
                                    <paper-checkbox item-icon></paper-checkbox>
                                    <div class="flex selectAll">Seleziona tutto</div>
                                </paper-icon-item>

                                <template is="dom-repeat" items="[[pagamentoCorrente.esiti]]" filter="_filtraListaRisultati">
                                    <paper-icon-item class$="[[isEven(index)]]">
                                        <paper-checkbox item-icon hidden$="{{!abilitaSelezione}}"></paper-checkbox>
                                        <paper-item-body two-line>
                                            <div>Ultima spedizione: [[_getDataFieldAsString(item,'dataOraUltimaSpedizione')]], Stato: [[item.statoSpedizione]]</div>
                                            <div secondary>Data Creazione: [[_getDataFieldAsString(item,'dataOraCreazione')]], Numero Tentativi: [[item.tentativiSpedizione]]</div>
                                        </paper-item-body>
                                    </paper-icon-item>
                                </template>
                            </paper-material>
                        </div>
                    </div>
                </iron-pages>
            </div>
        </div>
    </template>

    <script>
    (function() {
      'use strict';

      Polymer({
        is: 'pagamento-detail',

        properties: {
          titoloSezione: {
            type: String,
            value: 'Dettaglio Pagamento'
          },
          pagamentoCorrente: {
            type: Object,
            value: null
          },
          selectedTab: {
            type: Object,
            value: 0
          },
          dettaglioAnagrafica: {
            type: String,
            value: ''
          },
          singoliVersamenti: {
            type: Array
          },
           selectedTab: {type: Number, value : 0},
         filtro: {  type: String, value: ''},
          nascondiAzioneExport : { type: Boolean , value : true},
          nascondiAzioneCancella : {type: Boolean , value : true},
          abilitaSelezione : {type: Boolean , value : false}
        },

        ready: function() {
          //   console.log('ready function...');
        },
        _refreshList: function(){
        this.dataProvider = this.dataProvider.slice(0);
      },
        _filtraListaRisultati: function(item){
        var mostra = true;
        if (this.filtro && this.filtro!==''){
           if  (item.codEnte.toLowerCase().indexOf(this.filtro.toLowerCase())===-1 &&
              (item.ragioneSociale.toLowerCase().indexOf(this.filtro.toLowerCase())===-1)){
            mostra = false;
          }
        }
        return mostra;
      },
        _ricercaVuota: function(numeroRisultati){
            return numeroRisultati == 0;
        },
        isEven: function(index){
            if((index % 2)==0)
                return 'even';

            return 'odd';
        },
         _getAbilitatoAsString: function(abilitato){
            if(abilitato)
                return 'Abilitato';

            return 'Disabilitato';
      },
        _getAbilitatoSiNo: function(abilitato){
            if(abilitato)
                return 'SI';

            return 'NO';
      },

        _getProperty: function(oggetto, nomeProperty){
            if(oggetto){
                var val = oggetto[nomeProperty];
                return val;
            }
            return '';
        },


         _getPropertyVersamento: function(pagamentoCorrente, nomeProperty){
            var pag = this._getVersamento(pagamentoCorrente);
            if(pag){
                var val = pag[nomeProperty];
                return val;
            }
            return '';
        },

        _getVersamento: function(pagamentoCorrente) {
           var versamento = this._getProperty(pagamentoCorrente,'versamento');

           if(versamento)
             return versamento;

            return {};
        },
         _getPropertyEnte: function(pagamentoCorrente, nomeProperty){
            var ente = this._getEnte(pagamentoCorrente);
            if(ente){
                var val = ente[nomeProperty];
                return val;
            }
            return '';
        },
        _getEnte: function(pagamentoCorrente) {
           var ente = this._getProperty(pagamentoCorrente,'ente');

           if(ente)
             return ente;

            return {};
        },

         _getPropertyApplicazione: function(pagamentoCorrente, nomeProperty){
            var applicazione = this._getApplicazione(pagamentoCorrente);
            if(applicazione){
                var val = applicazione[nomeProperty];
                return val;
            }
            return '';
        },
        _getApplicazione: function(pagamentoCorrente) {
           var applicazione = this._getProperty(pagamentoCorrente,'applicazione');

           if(applicazione)
             return applicazione;

            return {};
        },

        _getPropertyPsp: function(pagamentoCorrente, nomeProperty){
            var psp = this._getProperty(pagamentoCorrente,'psp');

            if(psp){
                var val = psp[nomeProperty];
                return val;
            }
            return '';
        },

        _getPropertyRpt: function(pagamentoCorrente, nomeProperty){
            var rpt = this._getProperty(pagamentoCorrente,'rpt');

            if(rpt){
                var val = rpt[nomeProperty];
                return val;
            }
            return '';
        },

         _getPropertyRt: function(pagamentoCorrente, nomeProperty){
            var rt = this._getProperty(pagamentoCorrente,'rt');

            if(rt){
                var val = rt[nomeProperty];
                return val;
            }
            return '';
        },

        _getCCP: function (pagamentoCorrente){
            var pag = this._getVersamento(pagamentoCorrente);
            if(pag){
                var rpt = this._getProperty(pagamentoCorrente, 'rpt');

                if(rpt)
                    return rpt.ccp;
            }

            return 'N/A';
        },

         _getDebitore: function (pagamentoCorrente){
            var pag = this._getVersamento(pagamentoCorrente);
            if(pag){
                var anagrafica = this._getProperty(pag, 'anagraficaDebitore');

                if(anagrafica){
                   return this._getDettaglioAnagrafica(anagrafica);
                }
            }

            return 'N/A';
        },
         _getVersante: function (pagamentoCorrente){
            var pag = this._getVersamento(pagamentoCorrente);
            if(pag){
                var anagrafica = this._getProperty(pag, 'anagraficaVersante');

                if(anagrafica){
                    return this._getDettaglioAnagrafica(anagrafica);
                }
            }

            return '';
        },

        _getStatoRendicontazionePagamento: function(pagamentoCorrente) {
         var pag = this._getVersamento(pagamentoCorrente);
          var statoRendicontazione = '';

            if(pag)
              statoRendicontazione = pag.statoRendicontazione;

          if(statoRendicontazione == 'NON_RENDICONTATO'){
            return 'Non Rendicontato';
          } else if(statoRendicontazione == 'RENDICONTATO'){
            return 'Rendicontato';
          } else if(statoRendicontazione == 'RENDICONTATO_PARZIALE'){
            return 'Rendicontato Parziale';
          }

          return 'Non Rendicontato';
        },

         _getStatoPagamento: function(pagamentoCorrente) {
         var pag = this._getVersamento(pagamentoCorrente);
            var stato = '';

            if(pag)
              stato = pag.stato;

          if(stato == 'PAGAMENTO_ESEGUITO'){
            return 'Pagamento Eseguito';
          } else if(stato == 'IN_ATTESA'){
            return 'In Attesa';
          } else if(stato == 'FALLITO'){
            return 'Fallito';
          } else if(stato == 'IN_CORSO'){
            return 'In Corso';
          } else if(stato == 'AUTORIZZATO_DIFFERITO'){
            return 'Autorizzato Differito';
          } else if(stato == 'PAGAMENTO_NON_ESEGUITO'){
            return 'Pagamento non Eseguito';
          } else if(stato == 'PAGAMENTO_PARZIALMENTE_ESEGUITO'){
              return 'Pagamento Parzialmente Eseguito';
          }  else if(stato == 'DECORRENZA_TERMINI_PARZIALE'){
              return 'Decorrenza Termini Parziale';
          }  else if(stato == 'DECORRENZA_TERMINI'){
              return 'Decorrenza Termini';
          }  else if(stato == 'AUTORIZZATO_IMMEDIATO'){
              return 'Autorizzato Immediato';
          }

          return '';
        },

        downloadRpt: function (){

        },

        downloadRt: function (){

        },

        _visualizzaDettaglioBeneficiario: function(pagamentoCorrente) {
            var ente = this._getProperty(pagamentoCorrente,'ente');
            if(ente){
                var anagrafica = this._getProperty(ente, 'anagraficaEnte');

                return this._getDettaglioAnagrafica(anagrafica);
             }

             return '';
        },

        _getDettaglioAnagrafica: function(anagrafica) {
            if(anagrafica){
                    var text = anagrafica.ragioneSociale + ' ' + anagrafica.codUnivoco;

                    var indirizzo;

                     if(anagrafica.indirizzo)
                       indirizzo = anagrafica.indirizzo + ' ';

                     if(anagrafica.civico)
                       indirizzo += anagrafica.civico + ' ';

                     if(anagrafica.cap)
                       indirizzo+= anagrafica.cap + ' ';

                     if(anagrafica.localita)
                       indirizzo += anagrafica.localita;

                     if(anagrafica.provincia)
                       indirizzo += ' (' + anagrafica.provincia + ') ';

                     if(anagrafica.nazione)
                       indirizzo += anagrafica.nazione;

                       text += ' ';
                       text += indirizzo || '';
                       return text;

                }
           return '';
        },
        _getSottotipo: function(oggetto){
            if(oggetto){
                var val = oggetto['sottotipoEvento'];

                if(val == 'req')
                    return 'Richiesta';
                else
                    return 'Risposta';
            }
            return '';
        },

        _getDataFieldAsString: function(item,field) {
            var data = this._getProperty(item,field);
            if(data){

                var d = new Date(data);
                return this._dateFormat(d,'YYYY-MM-DD HH:mm:ss');

            }

            return '';
        },
         _dateFormat : function(date, format) {
            return moment(date).format(format);
        }
      });
    })();







    </script>

</dom-module>
