<link rel="import" href="../../../../bower_components/polymer/polymer.html">


<dom-module id="rendicontazione-detail">
    <template>
        <style include="shared-styles"></style>
        <style>
            :host {
            display: block;
            }
        </style>
        <div class="layout horizontal center-justified">
            <div class="layout vertical flex">
                <paper-tabs selected="{{selectedTab}}" noink>
                    <paper-tab>INFORMAZIONI GENERALI</paper-tab>
                    <paper-tab>SINGOLE RENDICONTAZIONI</paper-tab>
                </paper-tabs>

                <iron-pages selected="{{selectedTab}}">
                    <div class="layout horizontal center-justified">
                        <div id="itembox" class="layout vertical flex itembox restorePadding">
                            <div class="layout horizontal flex">
                                <div class="layout horizontal center start-justified headerbox" >

                                </div>
                            </div>

                            <paper-material elevation="0">
                                <!--  <p class="groupTitle"><span class="groupTitle">INFORMAZIONI INTERMEDIARIO</span></p>-->

                                <p class="groupItem"><span class="grouplabel">Id Regolamento: </span><span>[[_getProperty(rendicontazioneCorrente.fr,'iur')]]</span></p>
                                <p class="groupItem"><span class="grouplabel">Codice Flusso: </span><span>[[_getProperty(rendicontazioneCorrente.fr,'codFlusso')]]</span></p>
                                <p class="groupItem"><span class="grouplabel">Data Flusso: </span><span>[[_getDataFieldAsString(rendicontazioneCorrente.fr,'dataOraFlusso')]]</span></p>
                                <p class="groupItem"><span class="grouplabel">Anno Riferimento: </span><span>[[_getProperty(rendicontazioneCorrente.fr,'annoRiferimento')]]</span></p>
                                <p class="groupItem"><span class="grouplabel">Psp: </span><span>[[_getProperty(rendicontazioneCorrente.psp,'codPsp')]]</span></p>
                                <p class="groupItem"><span class="grouplabel">Data Regolamento: </span><span>[[_getDataFieldAsString(rendicontazioneCorrente.fr,'dataRegolamento')]]</span></p>
                                <p class="groupItem"><span class="grouplabel">Numero Pagamenti: </span><span>[[_getProperty(rendicontazioneCorrente.fr,'numeroPagamenti')]]</span></p>
                                <p class="groupItem"><span class="grouplabel">Importo Totale Pagamenti: </span><span>[[_getProperty(rendicontazioneCorrente.fr,'importoTotalePagamenti')]] &euro;</span></p>
                                <p class="groupItem"><span class="grouplabel">Stato: </span><span>[[_getProperty(rendicontazioneCorrente.fr,'stato')]]</span></p>
                                <p class="groupItem"><span class="grouplabel">Descrizione Stato: </span><span>[[_getProperty(rendicontazioneCorrente.fr,'descrizioneStato')]]</span></p>
                            </paper-material>
                        </div>
                    </div>

                    <div class="layout horizontal center-justified">
                        <div id="resultbox" class="layout vertical flex restorePadding" >
                            <div class="layout horizontal flex">
                                <div class="layout horizontal center start-justified headerbox" >
                                    <p>Il Flusso contiene [[rendicontazioneCorrente.fr.singolaRendicontazioneList.length]] Rendicontazioni</p>
                                </div>
                                <div id="listToolbox" class="layout horizontal center end-justified headerbox">
                                    <paper-icon-button icon="icons:file-upload" hidden$="{{nascondiAzioneExport}}"></paper-icon-button>
                                    <paper-icon-button icon="icons:remove" hidden$="{{nascondiAzioneCancella}}"></paper-icon-button>
                                </div>
                            </div>

                            <paper-material elevation="0">
                                <paper-input bind-value="{{filtro}}" on-bind-value-changed="_refreshList"
                                             class="flex filtro" label="Filtro">
                                </paper-input>
                                <paper-icon-item hidden$="{{!abilitaSelezione}}">
                                    <paper-checkbox item-icon></paper-checkbox>
                                    <div class="flex selectAll">Seleziona tutto</div>
                                </paper-icon-item>

                                <template is="dom-repeat" items="[[rendicontazioneCorrente.fr.singolaRendicontazioneList]]" filter="_filtraListaRisultati">
                                    <paper-icon-item class$="[[isEven(index)]]">
                                        <paper-checkbox item-icon hidden$="{{!abilitaSelezione}}"></paper-checkbox>
                                        <paper-item-body two-line>
                                            <div>IUR: [[item.iur]], IUV: [[item.iuv]], [[_getCodiceEsito(item.codiceEsito)]]
                                            </div>
                                            <div secondary>Data Esito: [[_getDataFieldAsString(item, 'dataEsito')]], Importo: [[item.singoloImporto]] &euro;</div>
                                        </paper-item-body>
                                    </paper-icon-item>
                                </template>
                            </paper-material>
                        </div>
                    </div>
                </iron-pages>
            </div>
        </div>
    </template>
    <script>
    (function() {
      'use strict';

      Polymer({
        is: 'rendicontazione-detail',

        properties: {
          titoloSezione: {
            type: String,
            value: 'Dettaglio Rendicontazione'
          },
          rendicontazioneCorrente: {
            type: Object,
            value: null
          },
          singoleRendicontazioni: {
            type: Array
          },
           selectedTab: {type: Number, value : 0},
         filtro: {  type: String, value: ''},
          nascondiAzioneExport : { type: Boolean , value : true},
          nascondiAzioneCancella : {type: Boolean , value : true},
          abilitaSelezione : {type: Boolean , value : false}
        },

        ready: function() {
          //   console.log('ready function...');
        },
         _getProperty: function(oggetto, nomeProperty){
            if(oggetto){
                var val = oggetto[nomeProperty];
                return val;
            }
            return '';
        },
        _refreshList: function(){
        this.dataProvider = this.dataProvider.slice(0);
      },
        _filtraListaRisultati: function(item){
        var mostra = true;
        if (this.filtro && this.filtro!==''){
           if  (item.codEnte.toLowerCase().indexOf(this.filtro.toLowerCase())===-1 &&
              (item.ragioneSociale.toLowerCase().indexOf(this.filtro.toLowerCase())===-1)){
            mostra = false;
          }
        }
        return mostra;
      },
        _ricercaVuota: function(numeroRisultati){
            return numeroRisultati == 0;
        },
        isEven: function(index){
            if((index % 2)==0)
                return 'even';

            return 'odd';
        },
         _getAbilitatoAsString: function(abilitato){
            if(abilitato)
                return 'Abilitato';

            return 'Disabilitato';
      },
         _getAbilitatoSiNo: function(abilitato){
            if(abilitato)
                return 'SI';

            return 'NO';
      },
      _getCodiceEsito: function(esito){
            if(esito == 0)
                return 'Pagamento Eseguito';

            if(esito == 3)
                return 'Pagamento Revocato';

            if(esito == 9)
                return 'Pagamento Eseguito senza RPT';

            return 'Esito non codificato (' + esito + ')';
      },
          _getListaSingoleRendicontazioni: function(rendicontazioneCorrente){
            //if(this.singoleRendicontazioni)
             //   return this.singoleRendicontazioni;
           // else{
                var tmp = this._getProperty(rendicontazioneCorrente,'singolaRendicontazioneList');
                 if(tmp){
                    this.singoleRendicontazioni = [];

                     for(var v in tmp){
                            this.singoleRendicontazioni.push({'expanded': false, 'singolaRendicontazione': tmp[v]});
                     }
                }

               return this.singoleRendicontazioni;
          //  }
        },
         _selectSingolaRendicontazione: function (e){
            var list = this.$.elencoSingoleRendicontazioni;
            var index = e.model.index;
            var isExpanded = list.items[index].expanded;
          //  console.log(isExpanded);
            list.set('singoleRendicontazioni.' + index + '.expanded', !isExpanded);
            list.updateSizeForItem(e.model.index);
        },
         getClassForItem: function(item, expanded) {
          return expanded ? 'horizontal layout div-table-row expanded' : 'horizontal layout div-table-row';
        },

        _getTitoloSezione: function (rendicontazioneCorrente){
            return this.titoloSezione;
        },

          _getDataFieldAsString: function(item,field) {
            var data = this._getProperty(item,field);
            if(data){

                var d = new Date(data);
                return this._dateFormat(d,'YYYY-MM-DD HH:mm:ss');

            }

            return '';
        },
         _dateFormat : function(date, format) {
            return moment(date).format(format);
        }
      });
    })();
    </script>

</dom-module>
