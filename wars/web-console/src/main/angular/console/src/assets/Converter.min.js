!function(o){const e={delimiter:"",newline:"",quoteChar:'"',escapeChar:'"',header:!0,trimHeaders:!1,dynamicTyping:!1,preview:0,encoding:"ISO-8859-1",worker:!1,comments:!1,step:void 0,download:!1,skipEmptyLines:!0,chunk:void 0,fastMode:void 0,beforeFirstChunk:void 0,withCredentials:void 0,transform:void 0};var t=!1,i={tassonomiaAvviso:["Cartelle esattoriali","Diritti e concessioni","Imposte e tasse","IMU","TASI e altre tasse comunali","Ingressi a mostre e musei","Multe e sanzioni amministrative","Previdenza e infortuni","Servizi erogati dal comune","Servizi erogati da altri enti","Servizi scolastici","Tassa automobilistica","Ticket e prestazioni sanitarie","Trasporti, mobilità e parcheggi"],tracciato:{},parsedData:[],init:function(){this.parsedData=[],this.tracciato={idTracciato:"",idDominio:"",inserimenti:[],annullamenti:[]}}};function a(o){i.init(),i.parsedData=o.data,t&&console.log("PARSED",i.parsedData);try{return i.parsedData.length>0?($.each(i.parsedData,function(o,e){t&&console.log("RIGA",o,e),function(o,e){if(function(o){return!!(o.idTracciato.length&&o.idDominio.length&&o.idA2A.length&&o.idPendenza.length)}(o))if(function(o,e){var a=!0;""==o.idTracciato?(a=!1,t&&console.log("idTracciato non presente alla riga",e)):""!=i.tracciato.idTracciato?i.tracciato.idTracciato!=o.idTracciato&&(a=!1,t&&console.log("idTracciato non corrispondente alla riga",e)):i.tracciato.idTracciato=o.idTracciato;""==o.idDominio?(a=!1,t&&console.log("idDominio non presente alla riga",e)):""!=i.tracciato.idDominio?i.tracciato.idDominio!=o.idDominio&&(a=!1,t&&console.log("idDominio non corrispondente alla riga",e)):i.tracciato.idDominio=o.idDominio;return a}(o,e)){var a=function(o,e){return!!(o.causale.length||o.soggetto_tipo.length||o.soggetto_identificativo.length||o.soggetto_anagrafica.length||o.soggetto_indirizzo.length||o.soggetto_civico.length||o.soggetto_cap.length||o.soggetto_localita.length||o.soggetto_provincia.length||o.soggetto_nazione.length||o.soggetto_email.length||o.soggetto_cellulare.length||o.importo.length||o.dataValidita.length||o.dataScadenza.length||o.tassonomia.length||o.tassonomiaAvviso.length||o.voce_indice.length||o.voce_idVocePendenza.length||o.voce_importo.length||o.voce_descrizione.length||o.voce_datiAllegati.length||o.voce_codEntrata.length||o.voce_ibanAccredito.length||o.voce_ibanAppoggio.length||o.voce_tipoContabilita.length||o.voce_tipoBollo.length||o.voce_hashDocumento.length||o.voce_provinciaResidenza.length)}(o);if(a&&o.motivoAnnullamento.length)t&&console.log("campi pendenza e annullamento presenti contemporaneamente alla riga",e);else if(a&&!o.motivoAnnullamento.length)if(function(o){return!(!o.causale.length||!o.importo.length)}(o)){var c=i.tracciato.inserimenti.filter(function(e){return e.idPendenza==o.idPendenza});c.length?c[0].voci.length<5?o.voce_idVocePendenza.length&&o.voce_importo.length&&o.voce_descrizione.length?n(o,e):t&&console.log("CAMPI OBBLIGATORI VOCE MANCANTI ALLA RIGA",e):t&&console.log("numero massimo di voci raggiunto per la pendenza",o.idPendenza,"la riga",e,"verrà ignorata"):function(o,e){const a={};a.idA2A=o.idA2A,a.idPendenza=o.idPendenza,a.causale=o.causale,a.importo=s(o.importo),a.soggettoPagatore={},a.voci=[],""!=o.idUnitaOperativa&&(a.idUnitaOperativa=o.idUnitaOperativa);""!=o.nome&&(a.nome=o.nome);""!=o.numeroAvviso&&(a.numeroAvviso=o.numeroAvviso);""!=o.dataCaricamento&&(a.dataCaricamento=d(o.dataCaricamento));""!=o.dataValidita&&(a.dataValidita=d(o.dataValidita));""!=o.dataScadenza&&(a.dataScadenza=d(o.dataScadenza));""!=o.annoRiferimento&&(a.annoRiferimento=o.annoRiferimento);""!=o.cartellaPagamento&&(a.cartellaPagamento=o.cartellaPagamento);""!=o.datiAllegati&&(a.datiAllegati=o.datiAllegati);""!=o.tassonomia&&(a.tassonomia=o.tassonomia);""!=o.tassonomiaAvviso&&(-1!=i.tassonomiaAvviso.indexOf(o.tassonomiaAvviso)?a.tassonomiaAvviso=o.tassonomiaAvviso:t&&console.log("tassonomiaAvviso ERRATA ALLA RIGA",e));""!=o.soggetto_tipo&&""!=o.soggetto_identificativo?("F"==o.soggetto_tipo||"G"==o.soggetto_tipo?a.soggettoPagatore.tipo=o.soggetto_tipo:t&&console.log("TIPO SOGGETTO PAGATORE NON CORRETTO ALLA RIGA",e),a.soggettoPagatore.identificativo=o.soggetto_identificativo):t&&console.log("DATI soggettoPagatore MANCANTI ALLA RIGA",e);""!=o.soggetto_anagrafica&&(a.soggettoPagatore.anagrafica=o.soggetto_anagrafica);""!=o.soggetto_indirizzo&&(a.soggettoPagatore.indirizzo=o.soggetto_indirizzo);""!=o.soggetto_civico&&(a.soggettoPagatore.civico=o.soggetto_civico);""!=o.soggetto_cap&&(a.soggettoPagatore.cap=o.soggetto_cap);""!=o.soggetto_localita&&(a.soggettoPagatore.localita=o.soggetto_localita);""!=o.soggetto_provincia&&(a.soggettoPagatore.provincia=o.soggetto_provincia);""!=o.soggetto_nazione&&(a.soggettoPagatore.nazione=o.soggetto_nazione);""!=o.soggetto_email&&(a.soggettoPagatore.email=o.soggetto_email);""!=o.soggetto_cellulare&&(a.soggettoPagatore.cellulare=o.soggetto_cellulare);o.voce_idVocePendenza.length&&o.voce_importo.length&&o.voce_descrizione.length?(i.tracciato.inserimenti.push(a),n(o,e)):t&&console.log("CAMPI OBBLIGATORI VOCE MANCANTI ALLA RIGA",e)}(o,e)}else t&&console.log("dati pendenza mancanti alla riga",e);else!a&&o.motivoAnnullamento.length?function(o){const e={idA2A:o.idA2A,idPendenza:o.idPendenza,motivoAnnullamento:o.motivoAnnullamento};i.tracciato.annullamenti.push(e)}(o):t&&console.log("nessun campo presente per pendenza o annullamento")}else t&&console.log("incongruenze nei campi tracciato alla riga",e);else t&&console.log("mancano i campi tracciato alla riga",e)}(e,o)}),t&&console.log("TRACCIATO",i.tracciato),i.tracciato):""}catch(o){return t&&console.log("ERRORE",o),""}}function n(o,e){const i={idVocePendenza:o.voce_idVocePendenza,importo:s(o.voce_importo),descrizione:o.voce_descrizione};o.voce_indice.length&&(i.indice=o.voce_indice),o.voce_datiAllegati.length&&(i.datiAllegati=o.voce_datiAllegati),!c(o)||g(o)||l(o)?!g(o)||c(o)||l(o)?!l(o)||c(o)||g(o)?t&&console.log("CAMPI VOCE NON CONFORMI ALLA RIGA",e):!function(o){return!!(o.voce_tipoBollo.length&&o.voce_hashDocumento.length&&o.voce_provinciaResidenza.length)}(o)?t&&console.log("CAMPI BOLLO DELLA VOCE MANCANTI NELLA RIGA",e):(i.tipoBollo=o.voce_tipoBollo,i.hashDocumento=o.voce_hashDocumento,i.provinciaResidenza=o.voce_provinciaResidenza,r(o,e,i)):!function(o){return!!(o.voce_ibanAccredito.length&&o.voce_tipoContabilita.length&&o.voce_codiceContabilita.length)}(o)?t&&console.log("CAMPI IBAN DELLA VOCE MANCANTI NELLA RIGA",e):(i.ibanAccredito=o.voce_ibanAccredito,i.tipoCompatibilita=o.voce_tipoContabilita,i.codiceContabilita=o.voce_tipoContabilita,o.voce_ibanAppoggio.length&&(i.ibanAppoggio=o.voce_ibanAppoggio),r(o,e,i)):(i.codEntrata=o.voce_codEntrata,r(o,e,i))}function c(o){return!!o.voce_codEntrata.length}function g(o){return!!(o.voce_ibanAccredito.length||o.voce_tipoContabilita.length||o.voce_codiceContabilita.length||o.voce_ibanAppoggio.length)}function l(o){return!!(o.voce_tipoBollo.length||o.voce_hashDocumento.length||o.voce_provinciaResidenza.length)}function r(o,e,t){$.each(i.tracciato.inserimenti,function(e,i){i.idPendenza!=o.idPendenza||i.voci.push(t)})}function s(o){var e=o.replace(",",".");return parseFloat(e).toFixed(2)}function d(o){var e=o.split("/"),t=e[2]+"/"+e[1]+"/"+e[0];return new Date(t).toISOString().substring(0,16)}o.Converter={verbose:t,setLog:function(o){t=o},filename:"File_"+Date.now()+".json",config:e,methods:function(){return[{name:"CSV v1",method:a,auto:!0,mimeType:"application/json"}]}}}(this);
