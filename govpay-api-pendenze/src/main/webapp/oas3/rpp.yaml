get_rpps:
  summary: Lista delle richieste di pagamento pendenza
  tags:
    - Pagamenti
  parameters:
    - $ref: './comuni.yaml#/pagina'
    - $ref: './comuni.yaml#/risultatiPerPagina'
    - $ref: './comuni.yaml#/campi'    
    - name: ordinamento
      in: query
      description: >-
        csv dei campi su cui ordinare i risultati, preceduti da + o - per ascendente o discendente (default ascendente)
         * dataRichiesta
         * esito
      required: false
      schema:
        type: string
        format: csv
        default: +dataRichiesta
    - in: query
      name: idDominio
      description: Codice fiscale del dominio beneficiario
      required: false
      schema:
        type: string
    - in: query
      name: iuv
      description: Identificativo univoco di versamento
      required: false
      schema:
        type: string
    - in: query
      name: ccp
      description: codice contesto pagamento
      required: false
      schema:
        type: string
    - in: query
      name: idA2A
      description: Codice del gestionale proprietario della pendenza
      required: false
      schema:
        type: string
    - in: query
      name: idPendenza
      description: Identrificativo della pendenza nel gestionale proprietario
      required: false
      schema:
        type: string
    - in: query
      name: esito
      description: esito della richiesta di pagamento
      required: false
      schema:
        $ref: '#/esitoRpt'
    - in: query
      name: idPagamento
      description: Identificativo del pagamento
      required: false
      schema:
        type: string
  responses:
    '200':
      description: Lista delle richieste di pagamento pendenza che rispettano i criteri di ricerca
      content:
        application/json:
          schema:
            allOf:
              - $ref: './comuni.yaml#/listaPaginata'
              - type: object
                required:
                  - risultati
                properties:
                  risultati:
                    type: array
                    items:
                      $ref: './rpp.yaml#/rppIndex'            
    '401':
      $ref: './errori.yaml#/responses/401'
    '403':
      $ref: './errori.yaml#/responses/403'
    '500':
      $ref: './errori.yaml#/responses/500'
get_rpp:
  summary: Dettaglio di una richiesta di pagamento pendenza
  tags:
    - Pagamenti
  parameters:
    - in: path
      name: idDominio
      description: Codice fiscale del dominio beneficiario
      required: true
      schema:
        type: string
    - in: path
      name: iuv
      description: Identificativo univoco di versamento
      required: true
      schema:
        type: string
    - in: path
      name: ccp
      description: Codice di contesto pagamento
      required: true
      schema:
        type: string
  responses:
    '201':
      description: Dettaglio della richiesta di pagamento
      content:
        application/json:
          schema:
            $ref: '#/rpp'            
    '401':
      $ref: './errori.yaml#/responses/401'
    '403':
      $ref: './errori.yaml#/responses/403'
    '404':
      $ref: './errori.yaml#/responses/400'
    '500':
      $ref: './errori.yaml#/responses/500'      
get_rpp_rpt:
  summary: Acquisizione della richiesta di pagamento pagopa
  tags:
    - Pagamenti
  parameters:
    - in: path
      name: idDominio
      description: Codice fiscale del dominio beneficiario
      required: true
      schema:
        type: string
    - in: path
      name: iuv
      description: Identificativo univoco di versamento
      required: true
      schema:
        type: string
    - in: path
      name: ccp
      description: Codice di contesto pagamento
      required: true
      schema:
        type: string
  responses:
    '200':
      description: Richiesta di pagamento
      content:
        application/xml:
          schema:
            type: string
            example: xml della richiesta di pagamento pagopa
        application/json:
          schema:
            type: string
            example: conversione json della richiesta di pagamento pagopa
    '401':
      $ref: './errori.yaml#/responses/401'
    '403':
      $ref: './errori.yaml#/responses/403'
    '404':
      $ref: './errori.yaml#/responses/404'
    '500':
      $ref: './errori.yaml#/responses/500'            
get_rpp_rt:
  summary: Acquisizione della ricevuta di pagamento
  tags:
    - Pagamenti
  parameters:
    - in: path
      name: idDominio
      description: Codice fiscale del dominio beneficiario
      required: true
      schema:
        type: string
    - in: path
      name: iuv
      description: Identificativo univoco di versamento
      required: true
      schema:
        type: string
    - in: path
      name: ccp
      description: Codice di contesto pagamento
      required: true
      schema:
        type: string
  responses:
    '200':
      description: Ricevuta di pagamento
      content:
        application/pdf:
          schema:
            type: string
            format: binary
            example: stampa della ricevuta
        application/xml:
          schema:
            type: string
            example: xml della ricevuta
        application/json:
          schema:
            type: string
            example: conversione json della ricevuta
    '401':
      $ref: './errori.yaml#/responses/401'
    '403':
      $ref: './errori.yaml#/responses/403'
    '404':
      $ref: './errori.yaml#/responses/404'
    '500':
      $ref: './errori.yaml#/responses/500'   
rppIndex:
  type: object
  required: 
    - stato
    - rpt
  properties:
    stato:
      type: string
      description: Stato della richiesta di pagamento sulla piattaforma PagoPA.
      example: RT_ACCETTATA_PA
    dettaglioStato:
      type: string
      description: >-
        Dettaglio fornito dal Nodo dei Pagamenti sullo stato della
        richiesta.
    segnalazioni:
      type: array
      items: 
        $ref: './comuni.yaml#/segnalazione'
    rpt:
      type: object
      description: "Rpt inviata a PagoPa. {http://www.digitpa.gov.it/schemas/2011/Pagamenti/} ctRichiestaPagamentoTelematico"
    rt:
      type: object
      description: "Rt inviata da PagoPa. {http://www.digitpa.gov.it/schemas/2011/Pagamenti/} ctRicevutaTelematica"  
    pendenza:
      type: string
      description: Url al dettaglio della pendenza
      example: '/pendenze/A2A-12345/abcdef12345'
rpp:
  type: object
  required: 
    - stato
    - rpt
  properties:
    stato:
      type: string
      description: Stato della richiesta di pagamento sulla piattaforma PagoPA.
      example: RT_ACCETTATA_PA
    dettaglioStato:
      type: string
      description: >-
        Dettaglio fornito dal Nodo dei Pagamenti sullo stato della
        richiesta.
    segnalazioni:
      type: array
      items: 
        $ref: './comuni.yaml#/segnalazione'
    rpt:
      type: object
      description: "Rpt inviata a PagoPa. {http://www.digitpa.gov.it/schemas/2011/Pagamenti/} ctRichiestaPagamentoTelematico"
    rt:
      type: object
      description: "Rt inviata da PagoPa. {http://www.digitpa.gov.it/schemas/2011/Pagamenti/} ctRicevutaTelematica"  
    pendenza:
      $ref: './pendenze.yaml#/pendenzaIndex'         
esitoRpt:
  example: ESEGUITO
  type: string
  enum:
    - IN_CORSO
    - RIFIUTATO
    - ESEGUITO
    - NON_ESEGUITO
    - ESEGUITO_PARZIALE
    - DECORRENZA
    - DECORENNZA_PARZIALE
  description: > 
    Esito della richiesta di pagamento:
     * IN_CORSO: Pagamento in corso
     * RIFIUTATO: Pagamento rifiutato
     * ESEGUITO: Pagamento eseguito
     * NON_ESEGUITO: Pagamento non eseguito
     * ESEGUITO_PARZIALE: Pagamento parzialmente eseguito
     * DECORRENZA: Decorrenza termini
     * DECORRENZA_PARZIALE: Decorrenza termini parziale